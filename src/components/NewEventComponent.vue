<template>
  <div>
    <ul class="list-group-add-event">
      <b-form @submit="onSubmit" @reset="onReset" v-if="show">
        <b-form-group
          id="input-group-1"
          label="כותרת אירוע"
          label-for="input-1"
        >
          <b-form-input
            id="input-1"
            v-model="form.alertName"
            required
          ></b-form-input>
        </b-form-group>

        <b-form-group id="input-group-5" label="שעה" label-for="input-5">
          <b-form-timepicker
            id="input-5"
            v-model="form.time"
            required
          ></b-form-timepicker>
        </b-form-group>

        <b-form-group v-show="this.selectedLocation.length" id="input-group-10" label="מיקום" label-for="input-10">
          <b-form-input
            id="input-10"
            v-model="this.selectedLocation"
            required
          ></b-form-input>
        </b-form-group>

        <b-form-group id="input-group-2" label="סוג אירוע" label-for="input-2">
          <b-form-select
            id="input-2"
            v-model="form.eventType"
            :options="eventTypes"
            required
          ></b-form-select>
        </b-form-group>

        <b-form-group id="input-group-3" label="חטמ'ר" label-for="input-3">
          <b-form-select
            id="input-3"
            v-model="form.sector"
            :options="sectors"
            required
          ></b-form-select>
        </b-form-group>

        <b-form-group id="input-group-4" label="אמל''ח" label-for="input-4">
          <b-form-select
            id="input-4"
            v-model="form.weapon"
            :options="weaponTypes"
            required
          ></b-form-select>

          <b-button
            v-show="!this.showAddInjury"
            variant="primary"
            @click="showAddInjuries"
            class="but"
            >הוספת פצועים</b-button
          >
        </b-form-group>

        <section v-show="this.showAddInjury">
          <b-form-group
            id="input-group-7"
            label="פצועים קל"
            label-for="input-7"
          >
            <b-form-input
              id="input-7"
              type="number"
              v-model.number="form.Injuries[0][1]"
              required
            ></b-form-input>
          </b-form-group>
          <b-form-group
            id="input-group-8"
            label="פצועים בינוני"
            label-for="input-8"
          >
            <b-form-input
              id="input-8"
              v-model.number="form.Injuries[1][1]"
              type="number"
              required
            ></b-form-input>
          </b-form-group>
          <b-form-group
            id="input-group-9"
            label="פצועים קשה"
            label-for="input-9"
          >
            <b-form-input
              id="input-9"
              type="number"
              v-model.number="form.Injuries[2][1]"
              required
            ></b-form-input>
          </b-form-group>
          <b-button variant="primary" @click="showAddInjuries" class="but"
            >הוספת פצוע</b-button
          >
        </section>

        <section v-if="!noInjuries && !this.showAddInjury">
          <b-container class="injured-info-container">
            <b-row class="justify-content-md-center">
              <b-button variant="outline-dark" disabled>
                פצועים קל:
                {{ this.form.Injuries[0][1] }}
              </b-button>
            </b-row>
            <b-row class="justify-content-md-center">
              <b-button variant="warning" disabled>
                פצועים בינוני:
                {{ this.form.Injuries[1][1] }}
              </b-button>
            </b-row>
            <b-row class="justify-content-md-center">
              <b-button variant="danger" disabled>
                פצועים קשה:
                {{ this.form.Injuries[2][1] }}
              </b-button>
            </b-row>
          </b-container>
        </section>
        <b-button
          @click="this.clearSelectedLocation"
          type="submit"
          variant="primary"
          class="but"
          >פרסם</b-button
        >
        <b-button type="reset" variant="danger" class="but">אפס</b-button>
      </b-form>
    </ul>
  </div>
</template>

<script>
import { mapState, mapActions } from "vuex";
import api from '../../api/api.js';

export default {
  data() {
    return {
      form: {
        Injuries: [
          [1, 0],
          [2, 0],
          [3, 0],
        ],
      },
      eventTypes: [],
      sectors: [],
      weaponTypes: [],
      showAddInjury: false,
      show: true,
      injuredId: 0,
    };
  },
    async created() {
    this.eventTypes = await (await api.eventTypes().getEventTypes()).data;
    this.sectors = await (await api.sectors().getRegionalBrigade()).data;
    this.weaponTypes = await (await api.weapons().getWeaponsTypes()).data;

    this.eventTypes = this.eventTypes.map((event) => event.name);
    this.sectors = this.sectors.map((sector) => sector.name);
    this.weaponTypes = this.weaponTypes.map((weapon) => weapon.weaponName);
  },
  methods: {
    ...mapActions(["clearSelectedLocation"]),
    onSubmit(event) {
      event.preventDefault();
      alert(JSON.stringify(this.form));
    },
    onReset(event) {
      event.preventDefault();
      this.form.alertName = "";
      this.form.eventType = null;
      this.form.location = "";
      this.form.weaponType = null;
      this.form.sector = null;
      this.form.time = null;
      this.form.Injuries = [
        [1, 0],
        [2, 0],
        [3, 0],
      ];
    },
    showAddInjuries() {
      this.showAddInjury = !this.showAddInjury;
    },
  },
  computed: {
    ...mapState(["selectedLocation"]),
    noInjuries() {
      console.log(this.form.Injuries[0][1]);
      return (
        this.form.Injuries[0][1] === 0 &&
        this.form.Injuries[1][1] === 0 &&
        this.form.Injuries[2][1] === 0
      );
    },
  },
};
</script>

<style scoped>
.b-row {
  width: 100%;
  margin-top: 5px;
}

.list-group-add-event {
  overflow: scroll;
  -webkit-overflow-scrolling: touch;
  margin-bottom: 10px;
  max-height: 700px;
  max-width: 600px;
  height: 700px;
  background-color: white;
}

.but {
  margin: 5px;
}
</style>
